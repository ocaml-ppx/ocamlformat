(* -*- tuareg -*- *)

let preprocess =
  match Jbuild_plugin.V1.context with
  | "coverage" -> "(preprocess (pps bisect_ppx))"
  | _ -> ""

;; Jbuild_plugin.V1.send @@ Format.sprintf "
(rule
 (targets Version.ml)
 (deps (universe))
 (action (run ../tools/gen_version.sh Version.ml))
 (mode fallback))

(ocamllex Literal_lexer)

(executable
 (name ocamlformat)
 (public_name ocamlformat)
 (package ocamlformat)
 (flags (:standard -open Import))
 %s
 (libraries cmdliner ocamlformat_support import ocaml-migrate-parsetree unix))
"
preprocess 
